<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Jeedom Home Control">
    <meta name="author" content="MULLER Franck">
    <title>Home Control</title>

    <!-- GOOGLE WEB FONT -->
    <link href="https://fonts.googleapis.com/css?family=Work+Sans:400,500,600" rel="stylesheet">

    <!-- BASE CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/menu.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/vendors.css" rel="stylesheet">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">


    <!-- YOUR CUSTOM CSS -->
    <link href="css/custom.css" rel="stylesheet">

    <!-- MODERNIZR MENU -->
    <script src="js/modernizr.js"></script>

</head>
<body>

<div id="preloader">
    <div data-loader="circle-side"></div>
</div><!-- /Preload -->

<div id="loader_form">
    <div data-loader="circle-side-2"></div>
</div><!-- /loader_form -->

<div class="container-fluid full-height">
    <div class="row row-height">
        <div class="col-lg-6 content-left">
            <div class="content-left-wrapper">
                <div id="social">
                    <ul>
                        <li><a href="#" id="open_bnb"><i class="icon-twitter"></i></a></li>
                    </ul>
                </div>
                <div>
                    <figure><img src="img/info_graphic_1.svg" alt="" class="img-fluid"></figure>
                    <h2>Intérieur</h2>
                    <div class="col-lg-6 float-left add_modules_l_left">

                    </div>
                    <div class="col-lg-6 float-right add_modules_l_right">

                    </div>

                </div>
                <div class="copy"></div>
            </div>
            <!-- /content-left-wrapper -->
        </div>
        <!-- /content-left -->
        <div id="panel_ext" class="panel_switch col-lg-6 " style="padding: 0">
            <div class="" style="   display: flex;
                                    justify-content: center;
                                    align-items: center;
                                    text-align: center;
                                    height: 100%;
                                    min-height: 100%;
                                    padding: 60px 90px 35px 90px;
                                    text-align: center;
                                    position: relative;">
                <div>
                    <figure><img src="img/info_graphic_2.svg" alt="" class="img-fluid"></figure>
                    <h2>Extérieur</h2>
                    <div class="col-lg-6 float-left add_modules_r_left">

                    </div>
                    <div class="col-lg-6 float-right add_modules_r_right">

                    </div>

                </div>
            </div>
            <!-- /content-left-wrapper -->
        </div>
        <div id="panel_bnb" class="panel_switch col-lg-6 d-none" style="padding: 0">
            <div class="" style="   display: flex;
                                    justify-content: center;
                                    align-items: center;
                                    text-align: center;
                                    height: 100%;
                                    min-height: 100%;
                                    padding: 60px 90px 35px 90px;
                                    text-align: center;
                                    position: relative;">
                <div>
                    <figure><img src="img/info_graphic_3.svg" alt="" class="img-fluid"></figure>
                    <h2>AirBnB</h2>
                    <div class="col-lg-6 float-left add_modules_c_left">

                    </div>
                    <div class="col-lg-6 float-right add_modules_c_right">

                    </div>
                </div>
            </div>
            <!-- /content-left-wrapper -->
        </div>

    </div>
</div>

<!-- COMMON SCRIPTS -->

<script src="js/jquery-3.2.1.min.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="js/moment.min.js"></script>
<!--<script src="js/common_scripts.min.js"></script>-->
<!--<script src="js/velocity.min.js"></script>-->
<script src="js/functions.js"></script>

<script>
    $(document).ready(function() {
        //temp
        var Jeedom_url = "192.168.8.200"; //demo IP
        var Jeedom_API = "lLmv2M8w7EdLRMuW9UgdwOBch37NRElb"; //demo key
        localStorage.setItem('Jeedom_url', Jeedom_url);
        localStorage.setItem('Jeedom_API', Jeedom_API);
        //date-time
        var dtime = moment().format('MMMM Do YYYY, h:mm:ss a');
        console.log(dtime);
        $(".dtime").html(dtime);
        //start call for create and update blocks
        $.ajax({
            url: "data/data.json?v=0.1.7",
            type: "GET",
            dataType: "json",
            success: function (e) {
                let append = '';
                var r = e.bloc_right.panel_left;
                var d = e.bloc_right.panel_right;
                var b = e.bloc_left.panel_left;
                var c = e.bloc_left.panel_right;
                var f = e.bloc_cached.panel_left;
                var g = e.bloc_cached.panel_right;

                //right block
                $.each(r, function(key,value) {

                    append = '<a href="#" id="'+value.id+'" cmd-id="'+value.cmd_id+'" refresh-id="'+value.refresh_id+'" >\n' +
                        '                            <div class="card text-white bg-primary mb-3" style="max-width: 18rem;">\n' +
                        '                                <div class="card-body">\n' +
                        '                                    <h5 class="card-title">'+value.name+'</h5>\n' +
                        '                                    <p class="card-text text-white">N/A</p>\n' +
                        '                                </div>\n' +
                        '                            </div>\n' +
                        '                        </a>';
                    $(".add_modules_r_left").append(append);

                    let n = value.id.startsWith("swt");
                    let nn = value.id.startsWith("temp");
                    if (n === true){
                        switch_state(value.refresh_id, value.id);
                    }
                    if (nn === true){
                        temp_state(value.refresh_id, value.id);
                    }

                });
                $.each(d, function(key,value) {
                    append = '<a href="#" id="'+value.id+'" cmd-id="'+value.cmd_id+'" refresh-id="'+value.refresh_id+'" >\n' +
                        '                            <div class="card text-white bg-primary mb-3" style="max-width: 18rem;">\n' +
                        '                                <div class="card-body">\n' +
                        '                                    <h5 class="card-title">'+value.name+'</h5>\n' +
                        '                                    <p class="card-text text-white">N/A</p>\n' +
                        '                                </div>\n' +
                        '                            </div>\n' +
                        '                        </a>';
                    $(".add_modules_r_right").append(append);
                    let n = value.id.startsWith("swt");
                    let nn = value.id.startsWith("temp");
                    if (n === true){
                        switch_state(value.refresh_id, value.id);
                    }
                    if (nn === true){
                        temp_state(value.refresh_id, value.id);
                    }
                });

                //left block
                $.each(b, function(key,value) {
                    var append_temp = '';
                    if (value.temp === "1"){
                        append_temp = '<small><span aria-hidden="true" temp-cmd-id="'+value.temp_refresh_id+'" id="'+value.temp_id+'"></span>°c / <span aria-hidden="true" hum-cmd-id="'+value.hum_refresh_id+'" id="'+value.hum_id+'"></span>%</small>';
                    }
                    append = '<a href="#" id="'+value.id+'" cmd-id="'+value.cmd_id+'" refresh-id="'+value.refresh_id+'" >\n' +
                        '                            <div class="card text-white bg-primary mb-3" style="max-width: 18rem;">\n' +
                        '                                <div class="card-body">\n' +
                        '                                    <h5 class="card-title">'+value.name+'</h5>\n' +
                        '                                    <p class="card-text text-white">N/A</p>\n' + append_temp +
                        '                                </div>\n' +
                        '                            </div>\n' +
                        '                        </a>';
                    $(".add_modules_l_left").append(append);
                    let n = value.id.startsWith("swt");
                    if (n === true){
                        switch_state(value.refresh_id, value.id);
                    }
                    if (value.temp === "1"){
                        temp_state(value.temp_refresh_id, value.temp_id);
                        temp_state(value.hum_refresh_id, value.hum_id);
                    }
                });
                $.each(c, function(key,value) {
                    var append_temp = '';
                    if (value.temp === "1"){
                        append_temp = '<small><span aria-hidden="true" temp-cmd-id="'+value.temp_refresh_id+'" id="'+value.temp_id+'"></span>°c / <span aria-hidden="true" hum-cmd-id="'+value.hum_refresh_id+'" id="'+value.hum_id+'"></span>%</small>';
                    }
                    append = '<a href="#" id="'+value.id+'" cmd-id="'+value.cmd_id+'" refresh-id="'+value.refresh_id+'" >\n' +
                        '                            <div class="card text-white bg-primary mb-3" style="max-width: 18rem;">\n' +
                        '                                <div class="card-body">\n' +
                        '                                    <h5 class="card-title">'+value.name+'</h5>\n' +
                        '                                    <p class="card-text text-white">N/A</p>\n' + append_temp +
                        '                                </div>\n' +
                        '                            </div>\n' +
                        '                        </a>';
                    $(".add_modules_l_right").append(append);
                    let n = value.id.startsWith("swt");
                    if (n === true){
                        switch_state(value.refresh_id, value.id);
                    }
                    if (value.temp === "1"){
                        temp_state(value.temp_refresh_id, value.temp_id);
                        temp_state(value.hum_refresh_id, value.hum_id);
                    }
                });

                //cached block
                $.each(f, function(key,value) {
                    var append_temp = '';
                    if (value.temp === "1"){
                        append_temp = '<small><span aria-hidden="true" temp-cmd-id="'+value.temp_refresh_id+'" id="'+value.temp_id+'"></span>°c / <span aria-hidden="true" hum-cmd-id="'+value.hum_refresh_id+'" id="'+value.hum_id+'"></span>%</small>';
                    }
                    append = '<a href="#" id="'+value.id+'" cmd-id="'+value.cmd_id+'" refresh-id="'+value.refresh_id+'" >\n' +
                        '                            <div class="card text-white bg-primary mb-3" style="max-width: 18rem;">\n' +
                        '                                <div class="card-body">\n' +
                        '                                    <h5 class="card-title">'+value.name+'</h5>\n' +
                        '                                    <p class="card-text text-white"></p>\n' + append_temp +
                        '                                </div>\n' +
                        '                            </div>\n' +
                        '                        </a>';
                    $(".add_modules_c_left").append(append);
                    let n = value.id.startsWith("swt");
                    if (n === true){
                        switch_state(value.refresh_id, value.id);
                    }
                    if (value.temp === "1"){
                        temp_state(value.temp_refresh_id, value.temp_id);
                        temp_state(value.hum_refresh_id, value.hum_id);
                    }
                });
                $.each(g, function(key,value) {
                    var append_temp = '';
                    if (value.temp === "1"){
                        append_temp = '<small><span aria-hidden="true" temp-cmd-id="'+value.temp_refresh_id+'" id="'+value.temp_id+'"></span>°c / <span aria-hidden="true" hum-cmd-id="'+value.hum_refresh_id+'" id="'+value.hum_id+'"></span>%</small>';
                    }
                    append = '<a href="#" id="'+value.id+'" cmd-id="'+value.cmd_id+'" refresh-id="'+value.refresh_id+'" >\n' +
                        '                            <div class="card text-white bg-primary mb-3" style="max-width: 18rem;">\n' +
                        '                                <div class="card-body">\n' +
                        '                                    <h5 class="card-title">'+value.name+'</h5>\n' +
                        '                                    <p class="card-text text-white"></p>\n' + append_temp +
                        '                                </div>\n' +
                        '                            </div>\n' +
                        '                        </a>';
                    $(".add_modules_c_right").append(append);
                    let n = value.id.startsWith("swt");
                    if (n === true){
                        switch_state(value.refresh_id, value.id);
                    }
                    if (value.temp === "1"){
                        temp_state(value.temp_refresh_id, value.temp_id);
                        temp_state(value.hum_refresh_id, value.hum_id);
                    }
                });
            },
            complete: function (e) {

            }
        });
        // update modules
        setInterval(update_page, 60000);
        // cached block
        $("#open_bnb").on('click', function () {
            $("#panel_ext").toggleClass("d-none");
            $("#panel_bnb").toggleClass("d-none");

        });
        // click modules on/off
        $(document).on('click','a[id^="swt_"]', function (e) {
            e.preventDefault();
            let cmd_id = $(this).attr("cmd-id");
            let refresh_id = $(this).attr("refresh-id");
            let swt_id = $(this).attr("id");
            //console.log(cmd_id+' '+swt_id);
            $.ajax({
                url: "http://192.168.8.200/core/api/jeeApi.php?apikey=lLmv2M8w7EdLRMuW9UgdwOBch37NRElb&type=cmd&id="+cmd_id,
                type: "GET",
                dataType: "json",
                success: function (r) {
                    // console.log(r);
                    if (r == 0){
                       //let response = switch_state (1383, "swt_cuisine");
                        setTimeout(function(){switch_state (refresh_id, swt_id)},700);
                    }
                    else{
                        $("#switch").text("error")
                    }
                }
            })
        })

    });
    //update page modules
    function update_page() {
        $.ajax({
            url: "data/data.json?v=0.1.6",
            type: "GET",
            dataType: "json",
            success: function (e) {
                var r = e.bloc_right.panel_left;
                var d = e.bloc_right.panel_right;
                var b = e.bloc_left.panel_left;
                var c = e.bloc_left.panel_right;
                var f = e.bloc_cached.panel_left;
                var g = e.bloc_cached.panel_right;

                $.each(r, function(key,value) {
                    let n = value.id.startsWith("swt");
                    if (n === true){
                        switch_state(value.refresh_id, value.id);
                    }
                    if (value.temp === "1"){
                        temp_state(value.temp_refresh_id, value.temp_id);
                        temp_state(value.hum_refresh_id, value.hum_id);
                    }
                });
                $.each(d, function(key,value) {
                    let n = value.id.startsWith("swt");
                    if (n === true){
                        switch_state(value.refresh_id, value.id);
                    }
                    if (value.temp === "1"){
                        temp_state(value.temp_refresh_id, value.temp_id);
                        temp_state(value.hum_refresh_id, value.hum_id);
                    }
                });
                $.each(b, function(key,value) {
                    let n = value.id.startsWith("swt");
                    if (n === true){
                        switch_state(value.refresh_id, value.id);
                    }
                    if (value.temp === "1"){
                        temp_state(value.temp_refresh_id, value.temp_id);
                        temp_state(value.hum_refresh_id, value.hum_id);
                    }
                });
                $.each(c, function(key,value) {
                    let n = value.id.startsWith("swt");
                    if (n === true){
                        switch_state(value.refresh_id, value.id);
                    }
                    if (value.temp === "1"){
                        temp_state(value.temp_refresh_id, value.temp_id);
                        temp_state(value.hum_refresh_id, value.hum_id);
                    }
                });
                $.each(f, function(key,value) {
                    let n = value.id.startsWith("swt");
                    if (n === true){
                        switch_state(value.refresh_id, value.id);
                    }
                    if (value.temp === "1"){
                        temp_state(value.temp_refresh_id, value.temp_id);
                        temp_state(value.hum_refresh_id, value.hum_id);
                    }
                });
                $.each(g, function(key,value) {
                    let n = value.id.startsWith("swt");
                    if (n === true){
                        switch_state(value.refresh_id, value.id);
                    }
                    if (value.temp === "1"){
                        temp_state(value.temp_refresh_id, value.temp_id);
                        temp_state(value.hum_refresh_id, value.hum_id);
                    }
                });
            }
        });

        // temp_state(1564, "temp_salon");
        // temp_state(1565, "hum_salon");
        // temp_state(1559, "temp_room");
        // temp_state(1560, "hum_room");
        // temp_state(1573, "temp_bnb_h");
        // temp_state(1582, "temp_bnb_b");
        // temp_state(1574, "hum_bnb_h");
        // temp_state(1583, "hum_bnb_b");
        //
        // switch_state(1383, "swt_cuisine");
        // switch_state(13, "swt_salon");
        // switch_state(1320, "swt_sdb");
        // switch_state(1166, "swt_bnb_cum");
        // switch_state(871, "swt_room")
    }
    //update modules function
    function temp_state(cmd_id, switch_id) {
        $.ajax({
            url: "http://"+localStorage.getItem('Jeedom_url')+"/core/api/jeeApi.php?apikey="+localStorage.getItem('Jeedom_API')+"&type=cmd&id="+cmd_id,
            type: "GET",
            dataType: "json",
            success: function (r) {
                //console.log(r);
                $("#"+switch_id).text(r);
            }
        })
    }
    function switch_state(cmd_id, switch_id){
        $.ajax({
            url: "http://"+localStorage.getItem('Jeedom_url')+"/core/api/jeeApi.php?apikey="+localStorage.getItem('Jeedom_API')+"&type=cmd&id="+cmd_id,
            type: "GET",
            dataType: "json",
            success: function (r) {
                // console.log(r);
                if (r == 0){
                    // $("#"+switch_id).text("OFF").attr("style", "background-color: #434bdf");
                    $("#"+switch_id+" .card").attr("style", "background-color: #434bdf!important");
                    $("#"+switch_id+" .card-text").text("Éteind");
                    if (switch_id === "swt_salon"){
                        $("#"+switch_id).attr("cmd-id", "15")
                    }
                    if (switch_id === "swt_bnb_cum"){
                        $("#"+switch_id).attr("cmd-id", "1168")
                    }
                }
                if (r == 1){
                    //$("#"+switch_id).text("ON").attr("style", "background-color: #d80075")
                    $("#"+switch_id+" .card").attr("style", "background-color: #d80075!important");
                    $("#"+switch_id+" .card-text").text("Allumé");
                    if (switch_id === "swt_salon"){
                        $("#"+switch_id).attr("cmd-id", "14")
                    }
                    if (switch_id === "swt_bnb_cum"){
                        $("#"+switch_id).attr("cmd-id", "1169")
                    }
                }
            }
        })
    }
</script>
</body>
</html>